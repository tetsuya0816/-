<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾ä¼šç§‘ã‚¯ã‚¨ã‚¹ãƒˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: grid;
            grid-template-columns: 3fr 1fr;
            grid-template-rows: auto 1fr;
            height: 95vh;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px 30px;
            text-align: center;
            position: relative;
            grid-column: 1 / -1;
        }
        
        .header::before {
            content: 'âš”ï¸';
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
        }
        
        .header::after {
            content: 'ğŸ°';
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
        }
        
        .title {
            font-size: 2.8em;
            font-weight: 900;
            margin-bottom: 8px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            letter-spacing: 0.1em;
            background: linear-gradient(45deg, #ffffff, #f8f9fa, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }
        
        .subtitle {
            font-size: 1em;
            opacity: 0.9;
        }
        
        .world-map {
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 20%, #228B22 40%, #8B4513 60%, #4682B4 80%, #DC143C 100%);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow-y: auto;
            grid-column: 1;
            grid-row: 2;
        }
        
        .hero-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            margin-bottom: 10px;
        }
        
        .hero-avatar {
            font-size: 3em;
            filter: drop-shadow(3px 3px 8px rgba(0,0,0,0.4));
            transition: all 0.5s ease;
            animation: heroGlow 3s infinite alternate;
        }
        
        .hero-title {
            font-size: 1em;
            font-weight: 700;
            color: #333;
            text-align: center;
            white-space: nowrap;
        }
        
        .level-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        @keyframes heroGlow {
            from { 
                filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
                transform: scale(1);
            }
            to { 
                filter: drop-shadow(2px 2px 8px rgba(255,255,255,0.4));
                transform: scale(1.05);
            }
        }
        
        .map-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            max-width: 800px;
            width: 100%;
            background: rgba(0,0,0,0.1);
            padding: 10px;
            border-radius: 15px;
            position: relative;
        }
        
        .map-tile {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        /* æ‘ã‚¨ãƒªã‚¢ (1-10) */
        .map-tile.village {
            background: linear-gradient(135deg, #98FB98, #90EE90);
            box-shadow: 0 2px 8px rgba(152, 251, 152, 0.4);
        }
        
        /* æ£®ã‚¨ãƒªã‚¢ (11-20) */
        .map-tile.forest {
            background: linear-gradient(135deg, #228B22, #32CD32);
            box-shadow: 0 2px 8px rgba(34, 139, 34, 0.4);
        }
        
        /* å±±ã‚¨ãƒªã‚¢ (21-30) */
        .map-tile.mountain {
            background: linear-gradient(135deg, #8B4513, #A0522D);
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.4);
        }
        
        /* æµ·ã‚¨ãƒªã‚¢ (31-40) */
        .map-tile.ocean {
            background: linear-gradient(135deg, #4682B4, #87CEEB);
            box-shadow: 0 2px 8px rgba(70, 130, 180, 0.4);
        }
        
        /* ç«å±±ãƒ»é­”ç‹åŸã‚¨ãƒªã‚¢ (41-50) */
        .map-tile.volcano {
            background: linear-gradient(135deg, #DC143C, #FF4500);
            box-shadow: 0 2px 8px rgba(220, 20, 60, 0.4);
        }
        
        /* ãƒœã‚¹ã‚¿ã‚¤ãƒ« */
        .map-tile.boss {
            width: 40px;
            height: 40px;
            font-size: 1.4em;
            animation: bossGlow 2s infinite alternate;
            border: 3px solid #FFD700;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.6);
        }
        
        /* æœ€çµ‚ãƒœã‚¹ */
        .map-tile.final-boss {
            width: 45px;
            height: 45px;
            font-size: 1.6em;
            animation: finalBossGlow 1.5s infinite alternate;
            border: 4px solid #FF1493;
            box-shadow: 0 6px 20px rgba(255, 20, 147, 0.8);
        }
        
        @keyframes bossGlow {
            from { 
                box-shadow: 0 4px 15px rgba(255, 215, 0, 0.6);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 6px 25px rgba(255, 215, 0, 0.9);
                transform: scale(1.1);
            }
        }
        
        @keyframes finalBossGlow {
            from { 
                box-shadow: 0 6px 20px rgba(255, 20, 147, 0.8);
                transform: scale(1) rotate(-2deg);
            }
            to { 
                box-shadow: 0 8px 30px rgba(255, 20, 147, 1);
                transform: scale(1.15) rotate(2deg);
            }
        }
        
        .hero {
            position: absolute;
            font-size: 1.5em;
            z-index: 10;
            transition: all 1.2s ease-in-out;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
            pointer-events: none;
        }
        
        .map-tile.defeated {
            filter: grayscale(70%) brightness(0.7);
            opacity: 0.8;
        }
        
        .defeated-mark {
            position: absolute;
            top: -3px;
            right: -3px;
            font-size: 0.7em;
            z-index: 15;
            animation: defeatPulse 2s infinite;
        }
        
        @keyframes defeatPulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 0.8;
            }
            50% { 
                transform: scale(1.2);
                opacity: 1;
            }
        }
        
        .area-label {
            background: rgba(255,255,255,0.9);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin: 10px 0;
        }
        
        .quiz-section {
            padding: 20px;
            grid-column: 2;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 15px;
            overflow-y: auto;
        }
        
        .progress-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .progress-text {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .current-stage {
            font-size: 1em;
            font-weight: 600;
            color: #667eea;
        }
        
        .goal-text {
            font-size: 0.9em;
            font-weight: 600;
            color: #e17055;
        }
        
        .current-area {
            font-size: 0.9em;
            font-weight: 600;
            color: #28a745;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            text-align: center;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-icon {
            font-size: 1.2em;
            margin-right: 8px;
        }
        
        .btn-subtitle {
            display: block;
            font-size: 0.85em;
            opacity: 0.9;
            margin-top: 3px;
        }
        
        .reset-section {
            text-align: center;
            margin-top: 15px;
            padding: 15px 0;
            border-top: 2px dashed #ddd;
        }
        
        .reset-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .result-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: modalSlideIn 0.5s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }
        
        .result-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .result-message {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .exp-gain {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            animation: expGlow 2s infinite alternate;
        }
        
        @keyframes expGlow {
            from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }
        
        .close-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ç¤¾ä¼šç§‘ã‚¯ã‚¨ã‚¹ãƒˆ</h1>
            <p class="subtitle">æ‘ã‹ã‚‰é­”ç‹ã®åŸã¾ã§ã€çŸ¥è­˜ã‚’é›†ã‚ã¦çœŸã®å‹‡è€…ã‚’ç›®æŒ‡ãã†ï¼</p>
        </div>
        
        <div class="world-map">
            <div class="hero-display">
                <div class="hero-avatar" id="heroAvatar">ğŸ§‘â€ğŸ“</div>
                <div class="hero-title" id="heroTitle">è¦‹ç¿’ã„å­¦è€…</div>
                <div class="level-badge">Lv.<span id="playerLevel">1</span></div>
            </div>
            
            <div class="area-label">ğŸ˜ï¸ å¹³å’Œãªæ‘ â†’ ğŸŒ² æ·±ã„æ£® â†’ â›°ï¸ é™ºã—ã„å±± â†’ ğŸŒŠ åºƒã„æµ· â†’ ğŸŒ‹ é­”ç‹ã®åŸ</div>
            
            <div class="map-board" id="mapBoard">
                <!-- ãƒãƒƒãƒ—ã‚¿ã‚¤ãƒ«ã¯JavaScriptã§ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="quiz-section">
            <div class="progress-info">
                <div class="progress-text">
                    <span class="current-stage">ç¾åœ¨ã®ãƒã‚¹: <span id="stageNumber">1</span>/50</span>
                    <span class="goal-text">ğŸ† ã‚´ãƒ¼ãƒ«ã¾ã§ã‚ã¨<span id="remainingSteps">49</span>ãƒã‚¹ï¼</span>
                    <span class="current-area" id="currentArea">ğŸ“ å¹³å’Œãªæ‘ã‚¨ãƒªã‚¢</span>
                </div>
            </div>
            
            <button class="submit-btn" id="perfectBtn">
                <span class="btn-icon">ğŸ¯</span>
                ã‚¯ãƒ©ã‚¹ã®ç›®æ¨™ã‚’é”æˆï¼
                <span class="btn-subtitle">å‹‡è€…ã‚’1ãƒã‚¹é€²ã‚ã‚‹</span>
            </button>
            
            <div class="reset-section">
                <button class="reset-btn" id="resetBtn">
                    æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™
                </button>
            </div>
        </div>
    </div>
    
    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <div class="result-icon" id="resultIcon">ğŸ‰</div>
            <h2 class="result-title" id="resultTitle">ç´ æ™´ã‚‰ã—ã„ï¼</h2>
            <p class="result-message" id="resultMessage">å…¨å•æ­£è§£ã§ã™ï¼</p>
            <div class="exp-gain" id="expGain">+50 EXPç²å¾—ï¼</div>
            <button class="close-btn" id="closeBtn">ç¶šã‘ã‚‹</button>
        </div>
    </div>

    <script>
        let gameData = {
            level: 1,
            exp: 0,
            position: 1, // 1-50ã®ãƒã‚¹
            stage: 1
        };

        // ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿
        const mapData = [
            // æ‘ã‚¨ãƒªã‚¢ (1-10) - 1è¡Œç›®
            { pos: 1, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 2, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 3, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 4, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 5, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 6, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 7, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 8, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 9, emoji: 'ğŸ˜ï¸', type: 'village', area: 'å¹³å’Œãªæ‘' },
            { pos: 10, emoji: 'ğŸº', type: 'village boss', area: 'å¹³å’Œãªæ‘' },
            
            // æ£®ã‚¨ãƒªã‚¢ (11-20) - 2è¡Œç›®
            { pos: 11, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 12, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 13, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 14, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 15, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 16, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 17, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 18, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 19, emoji: 'ğŸŒ²', type: 'forest', area: 'æ·±ã„æ£®' },
            { pos: 20, emoji: 'ğŸ‰', type: 'forest boss', area: 'æ·±ã„æ£®' },
            
            // å±±ã‚¨ãƒªã‚¢ (21-30) - 3è¡Œç›®
            { pos: 21, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 22, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 23, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 24, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 25, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 26, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 27, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 28, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 29, emoji: 'â›°ï¸', type: 'mountain', area: 'é™ºã—ã„å±±' },
            { pos: 30, emoji: 'ğŸ‘¹', type: 'mountain boss', area: 'é™ºã—ã„å±±' },
            
            // æµ·ã‚¨ãƒªã‚¢ (31-40) - 4è¡Œç›®
            { pos: 31, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 32, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 33, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 34, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 35, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 36, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 37, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 38, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 39, emoji: 'ğŸŒŠ', type: 'ocean', area: 'åºƒã„æµ·' },
            { pos: 40, emoji: 'ğŸ²', type: 'ocean boss', area: 'åºƒã„æµ·' },
            
            // é­”ç‹åŸã‚¨ãƒªã‚¢ (41-50) - 5è¡Œç›®
            { pos: 41, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 42, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 43, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 44, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 45, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 46, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 47, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 48, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 49, emoji: 'ğŸ°', type: 'volcano', area: 'é­”ç‹ã®é ˜åŸŸ' },
            { pos: 50, emoji: 'ğŸ˜ˆ', type: 'volcano final-boss', area: 'é­”ç‹ã®é ˜åŸŸ' }
        ];

        // ãƒãƒƒãƒ—ã‚’ç”Ÿæˆ
        function createMap() {
            const mapBoard = document.getElementById('mapBoard');
            mapBoard.innerHTML = '';
            
            mapData.forEach(tile => {
                const tileElement = document.createElement('div');
                tileElement.className = `map-tile ${tile.type}`;
                tileElement.id = `tile${tile.pos}`;
                tileElement.textContent = tile.emoji;
                
                if (tile.type.includes('boss')) {
                    tileElement.classList.add('boss');
                }
                if (tile.pos === 50) {
                    tileElement.classList.add('final-boss');
                }
                
                mapBoard.appendChild(tileElement);
            });
            
            // å‹‡è€…ã‚’è¿½åŠ 
            const hero = document.createElement('div');
            hero.className = 'hero';
            hero.id = 'hero';
            hero.textContent = 'ğŸ¦¸â€â™‚ï¸';
            mapBoard.appendChild(hero);
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadGameData() {
            const saved = localStorage.getItem('socialStudiesQuest50');
            if (saved) {
                gameData = JSON.parse(saved);
                updateDisplay();
            } else {
                updateDisplay();
            }
        }

        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        function saveGameData() {
            localStorage.setItem('socialStudiesQuest50', JSON.stringify(gameData));
        }

        // å‹‡è€…ã®è¦‹ãŸç›®ã‚’æ›´æ–°
        function updateHeroAppearance() {
            const heroAvatar = document.getElementById('heroAvatar');
            const heroTitle = document.getElementById('heroTitle');
            
            const heroLevels = [
                { level: 1, avatar: 'ğŸ§‘â€ğŸ“', title: 'è¦‹ç¿’ã„å†’é™ºè€…', color: '#74b9ff' },
                { level: 6, avatar: 'âš”ï¸', title: 'é§†ã‘å‡ºã—ã®å‰£å£«', color: '#00b894' },
                { level: 11, avatar: 'ğŸ›¡ï¸', title: 'åˆç´šé¨å£«', color: '#fdcb6e' },
                { level: 16, avatar: 'ğŸ—¡ï¸', title: 'ä¸­å …ã®æˆ¦å£«', color: '#e17055' },
                { level: 21, avatar: 'ğŸ¥·', title: 'ç†Ÿç·´ã®å‰£è±ª', color: '#a29bfe' },
                { level: 26, avatar: 'ğŸ¦¸â€â™‚ï¸', title: 'æ­´æˆ¦ã®è‹±é›„', color: '#fd79a8' },
                { level: 31, avatar: 'ğŸ‘¼', title: 'è–ãªã‚‹å®ˆè­·è€…', color: '#00cec9' },
                { level: 36, avatar: 'ğŸŒŸ', title: 'ä¼èª¬ã®å‰£è–', color: '#ffd700' },
                { level: 41, avatar: 'âœ¨', title: 'å…‰ã®å°ãæ‰‹', color: '#ff7675' },
                { level: 46, avatar: 'ğŸ‘‘', title: 'ä¼èª¬ã®å‹‡è€…', color: '#6c5ce7' }
            ];
            
            let currentHero = heroLevels[0];
            
            for (let i = heroLevels.length - 1; i >= 0; i--) {
                if (gameData.level >= heroLevels[i].level) {
                    currentHero = heroLevels[i];
                    break;
                }
            }
            
            heroAvatar.textContent = currentHero.avatar;
            heroTitle.textContent = currentHero.title;
            heroTitle.style.color = currentHero.color;
        }

        // ç¾åœ¨ã®ã‚¨ãƒªã‚¢ã‚’å–å¾—
        function getCurrentArea() {
            const currentTile = mapData.find(tile => tile.pos === gameData.position);
            return currentTile ? currentTile.area : 'æœªçŸ¥ã®é ˜åŸŸ';
        }

        // è¡¨ç¤ºã‚’æ›´æ–°
        function updateDisplay() {
            document.getElementById('playerLevel').textContent = gameData.level;
            document.getElementById('stageNumber').textContent = gameData.position;
            document.getElementById('remainingSteps').textContent = Math.max(0, 50 - gameData.position);
            document.getElementById('currentArea').textContent = `ğŸ“ ${getCurrentArea()}ã‚¨ãƒªã‚¢`;
            
            updateHeroAppearance();
            updateHeroPosition();
            
            if (gameData.position >= 50) {
                document.getElementById('perfectBtn').disabled = true;
                document.getElementById('perfectBtn').innerHTML = `
                    <span class="btn-icon">ğŸ†</span>
                    é­”ç‹è¨ä¼å®Œäº†ï¼
                    <span class="btn-subtitle">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</span>
                `;
            } else {
                document.getElementById('perfectBtn').disabled = false;
                document.getElementById('perfectBtn').innerHTML = `
                    <span class="btn-icon">ğŸ¯</span>
                    ã‚¯ãƒ©ã‚¹ã®ç›®æ¨™ã‚’é”æˆï¼
                    <span class="btn-subtitle">å‹‡è€…ã‚’1ãƒã‚¹é€²ã‚ã‚‹</span>
                `;
            }
        }

        // å‹‡è€…ã®ä½ç½®ã‚’æ›´æ–°
        function updateHeroPosition() {
            const hero = document.getElementById('hero');
            const mapBoard = document.getElementById('mapBoard');
            const tiles = mapBoard.querySelectorAll('.map-tile');
            
            // å…¨ã¦ã®ã‚¿ã‚¤ãƒ«ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            tiles.forEach((tile, index) => {
                tile.classList.remove('defeated');
                const defeatedMark = tile.querySelector('.defeated-mark');
                if (defeatedMark) {
                    defeatedMark.remove();
                }
            });
            
            // ç¾åœ¨ã®ä½ç½®ã®ã‚¿ã‚¤ãƒ«ã‚’å–å¾—
            const currentTile = document.getElementById(`tile${gameData.position}`);
            if (currentTile) {
                const rect = currentTile.getBoundingClientRect();
                const boardRect = mapBoard.getBoundingClientRect();
                
                const x = rect.left - boardRect.left + (rect.width / 2);
                const y = rect.top - boardRect.top + (rect.height / 2);
                
                hero.style.left = x + 'px';
                hero.style.top = y + 'px';
                hero.style.transform = 'translate(-50%, -50%)';
            }
            
            // å€’ã—ãŸãƒœã‚¹ã«ãƒãƒ¼ã‚¯ã‚’è¿½åŠ 
            for (let i = 1; i < gameData.position; i++) {
                const tile = document.getElementById(`tile${i}`);
                if (tile && (i % 10 === 0 || i === 50)) { // ãƒœã‚¹ã‚¿ã‚¤ãƒ«
                    tile.classList.add('defeated');
                    
                    if (!tile.querySelector('.defeated-mark')) {
                        const defeatedMark = document.createElement('div');
                        defeatedMark.className = 'defeated-mark';
                        defeatedMark.textContent = 'ğŸ’€';
                        tile.appendChild(defeatedMark);
                    }
                }
            }
        }

        // å‹‡è€…ã‚’1ãƒã‚¹é€²ã‚ã‚‹
        function moveHero() {
            if (gameData.position < 50) {
                gameData.position++;
                gameData.stage++;
                
                const oldLevel = gameData.level;
                gameData.exp += 50;
                let leveledUp = false;
                
                const newLevel = Math.floor(gameData.exp / 50) + 1;
                if (newLevel > gameData.level) {
                    gameData.level = newLevel;
                    leveledUp = true;
                }
                
                saveGameData();
                updateDisplay();
                
                if (gameData.position >= 50) {
                    showResult('goal', leveledUp);
                } else if (gameData.position % 10 === 0) {
                    showResult('boss', leveledUp);
                } else {
                    showResult('progress', leveledUp);
                }
            }
        }

        // çµæœè¡¨ç¤º
        function showResult(type, leveledUp = false) {
            const modal = document.getElementById('resultModal');
            const icon = document.getElementById('resultIcon');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');
            const expGain = document.getElementById('expGain');
            
            if (type === 'goal') {
                icon.textContent = 'ğŸ†';
                title.textContent = 'é­”ç‹è¨ä¼å®Œäº†ï¼';
                message.textContent = 'ç´ æ™´ã‚‰ã—ã„ï¼50ãƒã‚¹ã®å¤§å†’é™ºã‚’å®Œèµ°ã—ã€é­”ç‹ã‚’å€’ã—ã¾ã—ãŸï¼çœŸã®å‹‡è€…ã«ãªã‚Šã¾ã—ãŸï¼';
            } else if (type === 'boss') {
                icon.textContent = 'âš”ï¸';
                title.textContent = 'ãƒœã‚¹è¨ä¼ï¼';
                message.textContent = `${getCurrentArea()}ã®ãƒœã‚¹ã‚’å€’ã—ã¾ã—ãŸï¼æ¬¡ã®ã‚¨ãƒªã‚¢ã¸é€²ã¿ã¾ã—ã‚‡ã†ï¼`;
            } else if (type === 'reset') {
                icon.textContent = 'ğŸ”„';
                title.textContent = 'ãƒªã‚»ãƒƒãƒˆå®Œäº†ï¼';
                message.textContent = 'ã‚²ãƒ¼ãƒ ãŒåˆæœŸçŠ¶æ…‹ã«æˆ»ã‚Šã¾ã—ãŸï¼æ–°ã—ã„50ãƒã‚¹ã®å¤§å†’é™ºã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼';
                expGain.textContent = 'æ–°ãŸãªã‚¹ã‚¿ãƒ¼ãƒˆï¼';
                expGain.style.background = 'linear-gradient(135deg, #74b9ff, #0984e3)';
                expGain.style.color = 'white';
                modal.style.display = 'flex';
                return;
            } else {
                icon.textContent = 'âš¡';
                title.textContent = 'ç´ æ™´ã‚‰ã—ã„ï¼';
                message.textContent = `ãƒã‚¹${gameData.position - 1}ã‚¯ãƒªã‚¢ï¼å‹‡è€…ãŒ1ãƒã‚¹é€²ã¿ã¾ã—ãŸï¼`;
            }
            
            if (leveledUp) {
                expGain.innerHTML = `+50 EXPç²å¾—ï¼<br><span style="color: #ff6b6b; font-size: 1.1em;">ğŸŠ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv.${gameData.level} ğŸŠ</span>`;
            } else {
                expGain.textContent = '+50 EXPç²å¾—ï¼';
            }
            expGain.style.background = 'linear-gradient(135deg, #ffd700, #ffed4e)';
            expGain.style.color = '#333';
            
            modal.style.display = 'flex';
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            gameData = {
                level: 1,
                exp: 0,
                position: 1,
                stage: 1
            };
            
            saveGameData();
            updateDisplay();
            
            setTimeout(() => {
                showResult('reset');
            }, 300);
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('perfectBtn').addEventListener('click', function() {
            if (gameData.position < 50) {
                moveHero();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', resetGame);

        document.getElementById('closeBtn').addEventListener('click', function() {
            document.getElementById('resultModal').style.display = 'none';
        });

        // åˆæœŸåŒ–
        createMap();
        loadGameData();
        
        window.addEventListener('load', function() {
            setTimeout(updateHeroPosition, 100);
        });

        window.addEventListener('resize', function() {
            setTimeout(updateHeroPosition, 100);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96b4ad83f7fdd743',t:'MTc1NDU0NzcyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
